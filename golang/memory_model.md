# 内存模型

golang 内存模型有几个核心要点：

* 以空间换时间，一次缓存，多次复用

  由于每次向操作系统申请内存操作很重，所以就一次多申请一些，以备后用。

  Golang 中的堆 mheap 正是基于这个思想，产生的数据结构，我们可以从两个视角来看 Golang 运行时的堆：

  1. 对操作系统，是用户进程中缓存的内存
  2. 对于 go 进程内部，堆是所有对象的内存起源

* 多级缓存，实现无/细锁化

  ![memory_1](../image/go/memory/memory_1.png)

  堆是 Go 运行时最大的临界共享资源，意味着每次存取都要加锁。

  为了解决这个问题，Golang 在堆 mheap 上，依次细粒度化，建立了 mcentral、mcache 的模型，对三者说明如下：

  * mheap：全局的内存起源，访问要加全局锁

  * mcentral ：每种对象大小规格对应的缓存，锁的粒度仅限于同一种规格以内
  * mcache : 每个 P 持有一份的内存缓存，访问时无锁
  
* 多级规格，提高利用率

  

